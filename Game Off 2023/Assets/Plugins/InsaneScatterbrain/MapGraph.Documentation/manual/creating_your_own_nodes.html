<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Creating your own nodes </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Creating your own nodes ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="stylesheet" href="https://mapgraph.insanescatterbrain.com/styles/docfx.vendor.css">
    <link rel="stylesheet" href="https://mapgraph.insanescatterbrain.com/styles/featherlight.min.css">
    <link rel="stylesheet" href="https://mapgraph.insanescatterbrain.com/styles/docfx.css">
    <link rel="stylesheet" href="https://mapgraph.insanescatterbrain.com/styles/main.css">
    <meta property="docfx:navrel" content="../toc">
    <meta property="docfx:tocrel" content="toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                Home
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../manual/getting_started.html" title="Manual">Manual</a>
                      </li>
                      <li>
                          <a href="../nodes.html" title="Node Index">Node Index</a>
                      </li>
                      <li>
                          <a href="../api/InsaneScatterbrain.html" title="API">API</a>
                      </li>
                      <li>
                          <a href="../changelog.html" title="Changelog">Changelog</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidetoc">
                <div class="toc manual" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="creating_your_first_map_graph.html" title="Tutorials" class="">Tutorials</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="creating_your_first_map_graph.html" title="Creating your first map generator" class="">Creating your first map generator</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="creating_your_first_map_graph.html" title="1. Creating your first map graph" class="">1. Creating your first map graph</a>
                                </li>
                                <li class="">
                                  <a href="running_a_graph_at_runtime.html" title="2. Running a graph at runtime" class="">2. Running a graph at runtime</a>
                                </li>
                                <li class="">
                                  <a href="adding_more_nodes.html" title="3. Adding more nodes" class="">3. Adding more nodes</a>
                                </li>
                                <li class="">
                                  <a href="object_placement.html" title="4. Object placement" class="">4. Object placement</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="cave-like_maps.html" title="Basic map types" class="">Basic map types</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="cave-like_maps.html" title="&#8226; Cave-like maps" class="">&#8226; Cave-like maps</a>
                                </li>
                                <li class="">
                                  <a href="room-based_maps.html" title="&#8226; Room-based maps" class="">&#8226; Room-based maps</a>
                                </li>
                                <li class="">
                                  <a href="sample-based_maps.html" title="&#8226; Sample-based maps" class="">&#8226; Sample-based maps</a>
                                </li>
                                <li class="">
                                  <a href="combining_map_types.html" title="&#8226; Combining map types" class="">&#8226; Combining map types</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="linked_named_color_sets.html" title="More Tutorials" class="">More Tutorials</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="using_prefabs_instead_of_tilemaps.html" title="&#8226; Using prefabs instead of tilemaps" class="">&#8226; Using prefabs instead of tilemaps</a>
                                </li>
                                <li class="">
                                  <a href="linked_named_color_sets.html" title="&#8226; Linking a named color set to tilesets/prefab sets" class="">&#8226; Linking a named color set to tilesets/prefab sets</a>
                                </li>
                                <li class="">
                                  <a href="groups.html" title="&#8226; Organizing nodes into groups" class="">&#8226; Organizing nodes into groups</a>
                                </li>
                                <li class="">
                                  <a href="notes.html" title="&#8226; Adding notes &amp; comments" class="">&#8226; Adding notes &amp; comments</a>
                                </li>
                                <li class="">
                                  <a href="running_a_graph_within_a_graph.html" title="&#8226; Running a graph within a graph (Sub graphs)" class="">&#8226; Running a graph within a graph (Sub graphs)</a>
                                </li>
                                <li class="">
                                  <a href="tilemap_sets.html" title="&#8226; Tilemap Sets" class="">&#8226; Tilemap Sets</a>
                                </li>
                                <li class="">
                                  <a href="optimization_tips.html" title="&#8226; Optimization tips" class="">&#8226; Optimization tips</a>
                                </li>
                                <li class="">
                                  <a href="static_seed.html" title="&#8226; Static seed (daily challenges)" class="">&#8226; Static seed (daily challenges)</a>
                                </li>
                                <li class="">
                                  <a href="running_a_graph_asynchronously.html" title="&#8226; Running a graph asynchronously/multi-threaded" class="">&#8226; Running a graph asynchronously/multi-threaded</a>
                                </li>
                                <li class="">
                                  <a href="object_pooling.html" title="&#8226; Object pooling" class="">&#8226; Object pooling</a>
                                </li>
                                <li class="">
                                  <a href="unity_rule_tiles.html" title="&#8226; Tips for rule tiles" class="">&#8226; Tips for rule tiles</a>
                                </li>
                                <li class="">
                                  <a href="save_load_maps.html" title="&#8226; Saving and loading maps" class="">&#8226; Saving and loading maps</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="creating_your_first_map_graph.html" title="Tutorials for coders" class="">Tutorials for coders</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="running_graphs_from_scripts.html" title="&#8226; Running graphs from scripts" class="">&#8226; Running graphs from scripts</a>
                                </li>
                                <li class="">
                                  <a href="output_parameters.html" title="&#8226; Output parameters" class="">&#8226; Output parameters</a>
                                </li>
                                <li class="active">
                                  <a href="creating_your_own_nodes.html" title="&#8226; Creating your own nodes" class="active">&#8226; Creating your own nodes</a>
                                </li>
                                <li class="">
                                  <a href="creating_your_own_node_views.html" title="&#8226; Creating your own node views" class="">&#8226; Creating your own node views</a>
                                </li>
                                <li class="">
                                  <a href="adding_a_constant_node_type.html" title="&#8226; Adding a constant node type" class="">&#8226; Adding a constant node type</a>
                                </li>
                              </ul>  </li>
                        </ul>  </li>
                    <li class="">
                      <a href="sample_project.html" title="Sample Project" class="">Sample Project</a>
                    </li>
                    <li class="">
                      <a href="troubleshooting.html" title="Troubleshooting" class="">Troubleshooting</a>
                    </li>
                    <li class="">
                      <a href="support.html" title="Support" class="">Support</a>
                    </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="creating-your-own-nodes">Creating your own nodes</h1>

<p>Extending Map Graph's by writing your own node classes is easy.
There are some important considerations you need to take note of though.</p>
<p>Here's an example of a class for a custom node:</p>
<pre><code class="lang-csharp" name="ExampleNode">using System;
using System.Collections.Generic;
using InsaneScatterbrain.ScriptGraph;
using UnityEngine;

// The ScriptNode attribute makes sure that the node gets added to the context menu, so you can actually
// add them to your graphs.
// The serializable attribute is necessary, to be able to store the node in the map graph asset file.
[ScriptNode(&quot;Add Two Ints&quot;, &quot;Math&quot;), Serializable]
public class AddTwoIntsNode : ProcessorNode
{
    // By adding the InPort attribute, a port will automatically be created and assigned to this field.
    // In this case, it will be a port named &quot;Int A&quot;, accepting an integer as input.
    // By passing &quot;true&quot; as a third parameter, the port will require a connection for the graph to run.
    // Using SerializeReference here is necessary to make sure that the ports and their connections get persisted.
    [InPort(&quot;Int A&quot;, typeof(int), true), SerializeReference]
    private InPort intAIn = null;   // Initializing it to null is merely done to avoid the compiler from showing the &quot;never used&quot; warning.
    
    [InPort(&quot;Int B&quot;, typeof(int)), SerializeReference] 
    private InPort intBIn = null;
    
    /// Adding the OutPort attribute works the same as InPort.
    [OutPort(&quot;Total&quot;, typeof(int)), SerializeReference] 
    private OutPort sumOut = null;

    protected override void OnProcess()
    {
        // This is the method that is called when the node is asked to perform its task.

        // First we pull the values from our input ports.
        var intA = intAIn.Get&lt;int&gt;();
        var intB = intBIn.Get&lt;int&gt;();

        // Then we do the work.
        var total = intA + intB;

        // And we assign the values we want to output to the output ports.
        sumOut.Set(() =&gt; total);
    }
}
</code></pre>
<p>If you want to see some more complex examples, you can just take a look at the code of some of the existing nodes.</p>
<h2 id="important-considerations">Important considerations!</h2>
<p>There are some important things you need to take note of whenever you create your own nodes.</p>
<h3 id="be-careful-when-deleting-or-renaming-your-nodes-and-their-namespaces">Be careful when deleting or renaming your nodes and their namespaces</h3>
<p>Map Graph uses the <strong>SerializeReference</strong> attribute to store its nodes and ports. This attribute is a
relatively new addition to Unity and while it is very useful, it may or may not cause issues, depending
on which version of Unity you're using. This section describes how to work around these issues.</p>
<p>You might run into issues when node classes are deleted, renamed
or moved to another namespaces, if these nodes are present in any of your project's graphs.</p>
<p>The issue is described in the Unity Issue Tracker here:
<a href="https://issuetracker.unity3d.com/issues/serializereference-serialized-reference-data-lost-when-the-class-name-is-refactored">https://issuetracker.unity3d.com/issues/serializereference-serialized-reference-data-lost-when-the-class-name-is-refactored</a></p>
<p>If a node class is deleted, renamed or moved to a different namespace, Unity throws an <strong>Unknown managed type referenced</strong> exception and
will fail to load the graph.</p>
<p>There are some ways to deal with this issue.</p>
<h4 id="deleting-a-node-class">Deleting a node class</h4>
<p>If you want to delete a node class, make sure you've removed all of the nodes of that type from all of your project's graphs, before doing so.</p>
<h4 id="renaming-a-node-class-or-its-namespace">Renaming a node class or its namespace</h4>
<p>When renaming a node class or its namespace, there are two options.</p>
<h5 id="1-just-leave-it">1. Just leave it</h5>
<p>The easiest way to deal with this issue, is to just completely avoid renaming a class or moving it to a different namespace,
after you've started using it in your graphs.</p>
<p>If you want to give it a different name in the Map Graph editor, you can do so in the <strong>ScriptNode</strong> attribute.</p>
<h5 id="2-use-the-movedfrom-attribute">2. Use the MovedFrom attribute</h5>
<p>If you do want to rename a node's classname or move it to another namespace, you can use the <strong>MovedFrom</strong> attribute as
described in the Unity Issue Tracker.</p>
<p>For example, if you've renamed your class from <strong>ExampleNode</strong> to <strong>RenamedExampleNode</strong> you can fix it like this:</p>
<pre><code class="lang-cs">...
using UnityEngine.Scripting.APIUpdating;

[MovedFrom(false, null, null, &quot;ExampleNode&quot;)]
public class RenamedExampleNode : ProcessorNode
{
...
</code></pre>
<p>If you've moved the class to a different namespace:</p>
<pre><code class="lang-cs">[MovedFrom(false, &quot;Nodes.OriginalNamespace&quot;, null, null)]
</code></pre>
<p>If you've renamed it and moved it to a different namespace:</p>
<pre><code class="lang-cs">[MovedFrom(false, &quot;Nodes.OriginalNamespace&quot;, null, &quot;ExampleNode&quot;)]
</code></pre>
<p>Once you've recompiled your project with the attribute, the error should be gone and your graphs should work again.
At this point you can safely remove the MovedFrom attribute.</p>
<h3 id="make-sure-your-node-class-and-its-ports-have-the-right-attributes">Make sure your node class and its ports have the right attributes</h3>
<p>Nodes <strong>need</strong> to have the ScriptNode and Serializable attribute.</p>
<p>If you don't add the ScriptNode attribute it won't show up in the context menu and you won't be able to use it in your graphs.
If you don't add the Serializable attribute, data won't persist, meaning its ports and their connections.</p>
<p>Ports need to have the SerializeReference attribute (not to be confused with the SerializeField attribute) assigned to them,
for the same reason nodes need the Serializable attribute. SerializeField won't work, as it won't persist the references.</p>
<h3 id="making-copies-of-reference-types">Making copies of reference types</h3>
<p>If you pull a reference type from an input port and you want to make changes to that object, you'll need to make a copy of it first,
and apply your changes on that copy instead. If you don't make a copy, other input ports that pull data from the same output port,
will be presented with the changed version, which will lead to unexpected results.</p>
<h2 id="async-support">Async support</h2>
<p>It's possible for Map Graph to <a href="running_a_graph_asynchronously.html">run graphs asynchronously on a separate thread</a>.</p>
<p>In order for your node to support this, any call you make to the Unity API should be wrapped like so:</p>
<pre><code class="lang-cs">MainThread.Execute(() =&gt; {  
    // Make your Unity API calls here.  
}
</code></pre>
<p>Alternatively, you can use the OnProcessMainThread method, instead of the OnProcess method, to process the entire node on the main thread.</p>
<pre><code class="lang-cs">protected override void OnProcessMainThread()
{
    // Make your Unity API calls here.  
}
</code></pre>
<p>You can use both OnProcess and OnProcessMainThread in the same node, but be aware that OnProcess gets called before OnProcessMainThread.</p>
<p>What happens here, is that execution on the separate thread is halted, until the main thread has time to execute to
the code inside. Obviously, this can increase the execution time considerably, as execution is halted until
the main thread has done its job each time you do this. For this reason, you should keep the MainThread.Execute calls
(and therefore calls to the Unity API) to a minimum.</p>
<p>There are are some simple things you can do to make your node classes less dependent on the Unity API.</p>
<p>For example, for Map Graph's own nodes, <strong>Texture2D</strong> objects get converted to <strong>TextureData</strong> objects, so changes can be made to that data instead,
without having to call the Unity API each time. These objects need to be converted back to <strong>Texture2D</strong> objects at some point and
that's where you need the Unity API, but only in place.</p>
<p>Make sure you don't call MainThread.Execute in a loop. It's better to do something like this:</p>
<pre><code class="lang-cs">MainThread.Execute(() =&gt; {  
    for (var i = 0; i &lt; 1000; ++i)  
    {  
        NonUnityApiCall();  
        UnityApiCall();  
    }  
});
</code></pre>
<p>Then something like this:</p>
<pre><code class="lang-cs">for (var i = 0; i &lt; 1000; ++i)  
{  
    NonUnityApiCall();  
    MainThread.Execute(UnityApiCall);  
}
</code></pre>
<p>The latter might seem more efficient at first glance, because you'll only execute the Unity API dependant code on the main thread,
but the additional overhead for making many MainThread.Execute isn't worth it.</p>
<p>Obviously, you'll only have to keep this in mind if you want to keep async support intact. If you're sure you're only
going to run your graphs synchronously (on the main thread). You don't need to do any of this and you can call the Unity API
whenever you want. Just be aware that if you choose to run your graph asynchronously later on, there will be errors and it
will fail.</p>
<h2 id="ensuring-consistent-output-with-a-static-seed">Ensuring consistent output with a static seed</h2>
<p>In the likely event that you need to generate random numbers, normally, you'd probably use either
the static methods on Unity's Random class or you'd use an instance of .NET's Random class. However, in Map Graph's nodes
you should avoid doing so, because it won't guarantee a consistent output when using a static seed.</p>
<p>Instead, you'll want to get and use the Rng object, like so:</p>
<pre><code class="lang-cs">var rng = Get&lt;Rng&gt;();
var randomNumber = rng.Next(0, 100);
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="https://mapgraph.insanescatterbrain.com/styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="https://mapgraph.insanescatterbrain.com/styles/featherlight.min.js"></script>
    <script type="text/javascript" src="https://mapgraph.insanescatterbrain.com/styles/docfx.js"></script>
    <script type="text/javascript" src="https://mapgraph.insanescatterbrain.com/styles/main.js"></script>
  </body>
</html>
